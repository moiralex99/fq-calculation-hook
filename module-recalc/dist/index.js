import{useApi as e,useStores as r,defineModule as a}from"@directus/extensions-sdk";import{ref as n,computed as t,watch as l,onMounted as s,resolveComponent as o,resolveDirective as d,createBlock as i,openBlock as c,withCtx as u,createElementVNode as m,createElementBlock as v,createVNode as f,createTextVNode as p,toDisplayString as g,createCommentVNode as h,normalizeClass as b,withDirectives as y,vModelText as x,Fragment as k,renderList as w,withModifiers as _,vModelCheckbox as C}from"vue";var z=[],S=[];!function(e,r){if(e&&"undefined"!=typeof document){var a,n=!0===r.prepend?"prepend":"append",t=!0===r.singleTag,l="string"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName("head")[0];if(t){var s=z.indexOf(l);-1===s&&(s=z.push(l)-1,S[s]={}),a=S[s]&&S[s][n]?S[s][n]:S[s][n]=o()}else a=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),r.attributes)for(var a=Object.keys(r.attributes),t=0;t<a.length;t++)e.setAttribute(a[t],r.attributes[a[t]]);var s="prepend"===n?"afterbegin":"beforeend";return l.insertAdjacentElement(s,e),e}}('\r\n/* Container - Ultra compact for single page view */\n.recalc-container[data-v-554ffcde] {\r\n  padding: 0.75rem;\r\n  padding-top: 0;\r\n  max-width: 1400px;\r\n  margin: 0 auto;\r\n  height: calc(100vh - 110px);\r\n  overflow-y: auto;\n}\n.recalc-loading[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n  justify-content: center;\r\n  padding: 1.5rem;\r\n  color: var(--theme--foreground-subdued);\n}\r\n\r\n/* Result Card - Modern Design */\n.result-card[data-v-554ffcde] {\r\n  background: var(--theme--background);\r\n  border: 1px solid var(--theme--border-color);\r\n  border-radius: var(--theme--border-radius);\r\n  margin-bottom: 0.75rem;\r\n  overflow: hidden;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n}\n.result-card-header[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  gap: 1rem;\r\n  padding: 1rem;\r\n  border-bottom: 1px solid var(--theme--border-color-subdued);\n}\n.result-card-header.result-success[data-v-554ffcde] {\r\n  background: linear-gradient(to right, #e8f5e9 0%, var(--theme--background) 100%);\r\n  border-left: 4px solid #4caf50;\n}\n.result-card-header.result-warning[data-v-554ffcde] {\r\n  background: linear-gradient(to right, #fff3e0 0%, var(--theme--background) 100%);\r\n  border-left: 4px solid #ff9800;\n}\n.result-icon[data-v-554ffcde] {\r\n  flex-shrink: 0;\r\n  color: inherit;\n}\n.result-success .result-icon[data-v-554ffcde] {\r\n  color: #4caf50;\n}\n.result-warning .result-icon[data-v-554ffcde] {\r\n  color: #ff9800;\n}\n.result-main[data-v-554ffcde] {\r\n  flex: 1;\r\n  min-width: 0;\n}\n.result-title[data-v-554ffcde] {\r\n  margin: 0 0 0.5rem 0;\r\n  color: var(--theme--foreground);\r\n  font-size: 1rem;\r\n  font-weight: 600;\r\n  line-height: 1.3;\n}\n.result-meta[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n  flex-wrap: wrap;\r\n  font-size: 0.75rem;\r\n  color: var(--theme--foreground-subdued);\n}\n.result-collection[data-v-554ffcde] {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 0.25rem;\r\n  font-weight: 500;\r\n  color: var(--theme--primary);\n}\n.result-fields-count[data-v-554ffcde] {\r\n  color: var(--theme--foreground-subdued);\n}\n.result-badge[data-v-554ffcde] {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 0.25rem;\r\n  padding: 0.15rem 0.5rem;\r\n  border-radius: 999px;\r\n  font-weight: 500;\r\n  font-size: 0.7rem;\n}\n.result-badge-dry[data-v-554ffcde] {\r\n  background: var(--theme--background-subdued);\r\n  color: var(--theme--foreground);\r\n  border: 1px solid var(--theme--border-color);\n}\n.result-stats[data-v-554ffcde] {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\r\n  gap: 0;\n}\n.result-stat[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n  padding: 1rem;\r\n  border-right: 1px solid var(--theme--border-color-subdued);\r\n  transition: background 0.15s;\n}\n.result-stat[data-v-554ffcde]:last-child {\r\n  border-right: none;\n}\n.result-stat[data-v-554ffcde]:hover {\r\n  background: var(--theme--background-subdued);\n}\n.result-stat-icon[data-v-554ffcde] {\r\n  flex-shrink: 0;\r\n  color: var(--theme--primary);\r\n  opacity: 0.7;\n}\n.result-stat-content[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.15rem;\r\n  min-width: 0;\n}\n.result-stat-label[data-v-554ffcde] {\r\n  font-size: 0.65rem;\r\n  color: var(--theme--foreground-subdued);\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.5px;\r\n  font-weight: 500;\n}\n.result-stat-value[data-v-554ffcde] {\r\n  font-size: 1.25rem;\r\n  font-weight: 700;\r\n  color: var(--theme--foreground);\r\n  line-height: 1;\n}\r\n\r\n/* Progress Card - Ultra Compact */\n.progress-card[data-v-554ffcde] {\r\n  background: var(--theme--background);\r\n  border: 1px solid var(--theme--border-color);\r\n  border-radius: var(--theme--border-radius);\r\n  padding: 0.75rem;\r\n  margin-bottom: 0.75rem;\n}\n.progress-card h3[data-v-554ffcde] {\r\n  margin: 0 0 0.5rem 0;\r\n  color: var(--theme--foreground);\r\n  font-size: 0.95rem;\r\n  font-weight: 600;\n}\n.progress-details[data-v-554ffcde] {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-top: 0.5rem;\r\n  font-size: 0.75rem;\r\n  color: var(--theme--foreground-subdued);\n}\r\n\r\n/* Content Grid - Ultra Compact */\n.content-grid[data-v-554ffcde] {\r\n  display: grid;\r\n  grid-template-columns: 1fr 320px;\r\n  gap: 0.75rem;\r\n  align-items: start;\n}\n@media (max-width: 1024px) {\n.content-grid[data-v-554ffcde] {\r\n    grid-template-columns: 1fr;\n}\n}\r\n\r\n/* Config Card - Ultra Compact */\n.config-card[data-v-554ffcde] {\r\n  background: var(--theme--background);\r\n  border: 1px solid var(--theme--border-color);\r\n  border-radius: var(--theme--border-radius);\r\n  padding: 0.75rem;\n}\n.card-header[data-v-554ffcde] {\r\n  margin-bottom: 0.75rem;\n}\n.card-title[data-v-554ffcde] {\r\n  margin: 0;\r\n  color: var(--theme--foreground);\r\n  font-size: 0.95rem;\r\n  font-weight: 600;\n}\n.card-body[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\n}\r\n\r\n/* Form Groups - Ultra Compact */\n.form-group[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.3rem;\n}\n.form-label[data-v-554ffcde] {\r\n  font-weight: 500;\r\n  color: var(--theme--foreground);\r\n  font-size: 0.75rem;\n}\n.form-subtitle[data-v-554ffcde] {\r\n  font-size: 0.65rem;\r\n  color: var(--theme--foreground-subdued);\n}\n.form-hint-warning[data-v-554ffcde] {\r\n  color: var(--theme--warning, var(--theme--danger));\r\n  font-weight: 500;\n}\n.form-hint[data-v-554ffcde] {\r\n  font-size: 0.65rem;\r\n  color: var(--theme--foreground-subdued);\r\n  margin-top: -0.15rem;\n}\n.form-error[data-v-554ffcde] {\r\n  color: var(--theme--danger);\r\n  font-size: 0.7rem;\r\n  margin-top: 0.2rem;\n}\r\n\r\n/* Fields Container - Ultra Compact */\n.fields-container[data-v-554ffcde] {\r\n  border: 1px solid var(--theme--border-color);\r\n  border-radius: var(--theme--border-radius);\r\n  max-height: 220px;\r\n  overflow-y: auto;\r\n  background: var(--theme--background);\n}\n.fields-header[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.5rem;\r\n  padding: 0.65rem 0.75rem 0.75rem;\r\n  background: var(--theme--background-subdued);\r\n  border-bottom: 1px solid var(--theme--border-color);\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 1;\n}\n.fields-header[data-v-554ffcde]:hover {\r\n  background: var(--theme--background-accent);\n}\n.fields-header-top[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 0.5rem;\n}\n.fields-header-title[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  font-weight: 600;\r\n  font-size: 0.75rem;\r\n  user-select: none;\n}\n.fields-header-title input[type="checkbox"][data-v-554ffcde] {\r\n  cursor: pointer;\n}\n.fields-header-title label[data-v-554ffcde] {\r\n  cursor: pointer;\r\n  margin: 0;\n}\n.fields-count[data-v-554ffcde] {\r\n  font-size: 0.65rem;\r\n  color: var(--theme--foreground-subdued);\r\n  background: var(--theme--background);\r\n  border: 1px solid var(--theme--border-color-subdued);\r\n  border-radius: 999px;\r\n  padding: 0.15rem 0.5rem;\r\n  line-height: 1;\n}\n.fields-search[data-v-554ffcde],\r\n.select-search[data-v-554ffcde] {\r\n  width: 100%;\r\n  padding: 0.35rem 0.5rem;\r\n  border: 1px solid var(--theme--border-color-subdued);\r\n  border-radius: var(--theme--border-radius);\r\n  font-size: 0.75rem;\r\n  color: var(--theme--foreground);\r\n  background: var(--theme--background);\r\n  transition: border-color 0.15s, box-shadow 0.15s;\n}\n.fields-search[data-v-554ffcde]:focus,\r\n.select-search[data-v-554ffcde]:focus {\r\n  border-color: var(--theme--primary);\r\n  outline: none;\r\n  box-shadow: 0 0 0 1px var(--theme--primary-20, rgba(80, 86, 231, 0.2));\n}\n.fields-search[data-v-554ffcde]::placeholder,\r\n.select-search[data-v-554ffcde]::placeholder {\r\n  color: var(--theme--foreground-subdued);\n}\n.select-group-header[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  justify-content: space-between;\r\n  gap: 0.5rem;\n}\n.select-group-titles[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.15rem;\n}\n.select-count[data-v-554ffcde] {\r\n  font-size: 0.65rem;\r\n  color: var(--theme--foreground-subdued);\r\n  background: var(--theme--background-subdued);\r\n  border-radius: 999px;\r\n  padding: 0.15rem 0.5rem;\r\n  line-height: 1;\r\n  font-weight: 600;\n}\n.field-item[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  padding: 0.5rem 0.75rem;\r\n  border-bottom: 1px solid var(--theme--border-color-subdued);\r\n  cursor: pointer;\r\n  user-select: none;\r\n  transition: background 0.15s;\n}\n.field-item[data-v-554ffcde]:last-child {\r\n  border-bottom: none;\n}\n.field-item[data-v-554ffcde]:hover {\r\n  background: var(--theme--background-accent);\n}\n.field-item input[type="checkbox"][data-v-554ffcde] {\r\n  cursor: pointer;\n}\n.field-item label[data-v-554ffcde] {\r\n  cursor: pointer;\r\n  margin: 0;\r\n  font-size: 0.75rem;\r\n  color: var(--theme--foreground);\r\n  flex: 1;\n}\n.fields-empty[data-v-554ffcde] {\r\n  padding: 1.25rem;\r\n  text-align: center;\r\n  color: var(--theme--foreground-subdued);\r\n  font-size: 0.75rem;\n}\r\n\r\n/* Scrollbar */\n.fields-container[data-v-554ffcde]::-webkit-scrollbar {\r\n  width: 6px;\n}\n.fields-container[data-v-554ffcde]::-webkit-scrollbar-track {\r\n  background: var(--theme--background-subdued);\n}\n.fields-container[data-v-554ffcde]::-webkit-scrollbar-thumb {\r\n  background: var(--theme--border-color);\r\n  border-radius: 3px;\n}\n.fields-container[data-v-554ffcde]::-webkit-scrollbar-thumb:hover {\r\n  background: var(--theme--foreground-subdued);\n}\r\n\r\n/* Action Buttons - Ultra Compact */\n.action-buttons[data-v-554ffcde] {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n  margin-top: 0.75rem;\n}\r\n\r\n/* Sidebar - Ultra Compact */\n.sidebar[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\n}\r\n\r\n/* Stats Card - Ultra Compact */\n.stats-card[data-v-554ffcde] {\r\n  background: var(--theme--background);\r\n  border: 1px solid var(--theme--border-color);\r\n  border-radius: var(--theme--border-radius);\r\n  padding: 0.75rem;\n}\n.stats-grid[data-v-554ffcde] {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 0.5rem;\n}\n.stat-box[data-v-554ffcde] {\r\n  text-align: center;\r\n  padding: 0.6rem;\r\n  background: var(--theme--background-subdued);\r\n  border-radius: var(--theme--border-radius);\n}\n.stat-box .label[data-v-554ffcde] {\r\n  display: block;\r\n  font-size: 0.6rem;\r\n  color: var(--theme--foreground-subdued);\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.5px;\r\n  margin-bottom: 0.3rem;\n}\n.stat-box .value[data-v-554ffcde] {\r\n  display: block;\r\n  font-size: 1.35rem;\r\n  font-weight: 700;\r\n  color: var(--theme--primary);\n}\r\n\r\n/* Recent Card - Ultra Compact */\n.recent-card[data-v-554ffcde] {\r\n  background: var(--theme--background);\r\n  border: 1px solid var(--theme--border-color);\r\n  border-radius: var(--theme--border-radius);\r\n  padding: 0.75rem;\n}\n.formula-list[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.35rem;\r\n  margin-top: 0.5rem;\n}\n.formula-item[data-v-554ffcde] {\r\n  padding: 0.5rem;\r\n  background: var(--theme--background-subdued);\r\n  border: 1px solid var(--theme--border-color-subdued);\r\n  border-radius: var(--theme--border-radius);\r\n  cursor: pointer;\r\n  transition: all 0.15s;\n}\n.formula-item[data-v-554ffcde]:hover {\r\n  background: var(--theme--background-accent);\r\n  border-color: var(--theme--primary);\r\n  transform: translateX(2px);\n}\n.formula-item .collection[data-v-554ffcde] {\r\n  font-weight: 600;\r\n  color: var(--theme--foreground);\r\n  font-size: 0.75rem;\r\n  margin-bottom: 0.15rem;\n}\n.formula-item .field[data-v-554ffcde] {\r\n  color: var(--theme--foreground-subdued);\r\n  font-size: 0.65rem;\r\n  font-family: var(--theme--font-monospace);\n}\r\n\r\n/* Formula Tester - Collapsible */\n.formula-tester-card[data-v-554ffcde] {\r\n  background: var(--theme--background);\r\n  border: 1px solid var(--theme--border-color);\r\n  border-radius: var(--theme--border-radius);\r\n  margin-bottom: 0.75rem;\r\n  overflow: hidden;\n}\n.formula-tester-header[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  padding: 0.75rem;\r\n  background: linear-gradient(to right, var(--theme--primary-subdued, rgba(80, 86, 231, 0.1)) 0%, var(--theme--background) 100%);\r\n  border-left: 3px solid var(--theme--primary);\r\n  cursor: pointer;\r\n  user-select: none;\r\n  font-weight: 600;\r\n  color: var(--theme--foreground);\r\n  font-size: 0.85rem;\r\n  transition: background 0.15s;\n}\n.formula-tester-header[data-v-554ffcde]:hover {\r\n  background: linear-gradient(to right, var(--theme--primary-subdued, rgba(80, 86, 231, 0.15)) 0%, var(--theme--background-accent) 100%);\n}\n.formula-tester-badge[data-v-554ffcde] {\r\n  margin-left: auto;\r\n  font-size: 0.65rem;\r\n  background: var(--theme--primary);\r\n  color: white;\r\n  padding: 0.15rem 0.5rem;\r\n  border-radius: 999px;\r\n  font-weight: 600;\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.5px;\n}\n.formula-tester-body[data-v-554ffcde] {\r\n  padding: 0.75rem;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\r\n  border-top: 1px solid var(--theme--border-color-subdued);\n}\r\n\r\n/* Test Result Card */\n.test-result-card[data-v-554ffcde] {\r\n  border: 2px solid;\r\n  border-radius: var(--theme--border-radius);\r\n  padding: 0.75rem;\r\n  margin-top: 0.5rem;\n}\n.test-result-success[data-v-554ffcde] {\r\n  border-color: #4caf50;\r\n  background: linear-gradient(to right, #e8f5e9 0%, var(--theme--background) 100%);\n}\n.test-result-error[data-v-554ffcde] {\r\n  border-color: #f44336;\r\n  background: linear-gradient(to right, #ffebee 0%, var(--theme--background) 100%);\n}\n.test-result-header[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  margin-bottom: 0.5rem;\n}\n.test-result-title[data-v-554ffcde] {\r\n  font-weight: 600;\r\n  font-size: 0.85rem;\r\n  color: var(--theme--foreground);\n}\n.test-result-details[data-v-554ffcde] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.35rem;\r\n  font-size: 0.75rem;\n}\n.test-result-row[data-v-554ffcde] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\n}\n.test-result-label[data-v-554ffcde] {\r\n  font-weight: 600;\r\n  color: var(--theme--foreground-subdued);\r\n  min-width: 100px;\n}\n.test-result-value[data-v-554ffcde] {\r\n  color: var(--theme--foreground);\r\n  font-family: var(--theme--font-monospace);\n}\n.test-result-badge[data-v-554ffcde] {\r\n  padding: 0.15rem 0.5rem;\r\n  border-radius: 999px;\r\n  font-size: 0.65rem;\r\n  font-weight: 600;\r\n  text-transform: uppercase;\n}\n.test-result-badge.badge-local[data-v-554ffcde] {\r\n  background: #4caf50;\r\n  color: white;\n}\n.test-result-badge.badge-relational[data-v-554ffcde] {\r\n  background: #ff9800;\r\n  color: white;\n}\n.test-result-error-msg[data-v-554ffcde] {\r\n  color: var(--theme--danger);\r\n  font-size: 0.75rem;\r\n  font-family: var(--theme--font-monospace);\r\n  background: var(--theme--background);\r\n  padding: 0.5rem;\r\n  border-radius: var(--theme--border-radius);\r\n  border: 1px solid var(--theme--danger);\n}\r\n',{});var R=(e,r)=>{const a=e.__vccOpts||e;for(const[e,n]of r)a[e]=n;return a};const F={class:"recalc-module"},V={key:0,class:"recalc-loading"},O={key:2,class:"recalc-container"},U={key:0,class:"result-card"},A={class:"result-icon"},N={class:"result-main"},T={class:"result-title"},j={class:"result-meta"},E={class:"result-collection"},L={key:0,class:"result-fields-count"},$={key:1,class:"result-badge result-badge-dry"},D={class:"result-stats"},M={class:"result-stat"},J={class:"result-stat-icon"},q={class:"result-stat-content"},I={class:"result-stat-value"},B={class:"result-stat"},G={class:"result-stat-icon"},P={class:"result-stat-content"},X={class:"result-stat-value"},H={key:0,class:"result-stat"},K={class:"result-stat-icon"},Q={class:"result-stat-content"},W={class:"result-stat-value"},Y={key:1,class:"progress-card"},Z={class:"progress-details"},ee={key:0},re={class:"formula-tester-card"},ae={class:"formula-tester-header"},ne={class:"formula-tester-body"},te={class:"form-group"},le={class:"form-hint"},se={class:"form-group"},oe={key:0,class:"form-error"},de={class:"form-actions"},ie={class:"test-result-header"},ce={class:"test-result-title"},ue={key:0,class:"test-result-details"},me={class:"test-result-row"},ve={class:"test-result-value"},fe={key:0,class:"test-result-row"},pe={class:"test-result-value"},ge={class:"test-result-row"},he={key:1,class:"test-result-error-msg"},be={class:"content-grid"},ye={class:"config-card"},xe={class:"card-body"},ke={class:"form-group"},we={class:"select-group-header"},_e={key:0,class:"select-count"},Ce=["disabled"],ze={key:0,class:"form-hint form-hint-warning"},Se={class:"form-group"},Re={class:"fields-container"},Fe={class:"fields-header"},Ve={class:"fields-header-top"},Oe={class:"fields-header-title"},Ue=["checked",".indeterminate","disabled"],Ae={key:0,class:"fields-count"},Ne=["disabled"],Te={key:0,class:"fields-empty"},je={key:1,class:"fields-empty"},Ee={key:2,class:"fields-empty"},Le=["onClick"],$e=["id","value"],De=["for"],Me={class:"form-group"},Je={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"0.35rem"}},qe={style:{display:"flex","align-items":"center",gap:"0.35rem"}},Ie={key:0,class:"form-error"},Be={class:"form-group"},Ge={class:"form-group"},Pe={class:"form-actions"},Xe={class:"sidebar"},He={class:"stats-card"},Ke={class:"card-body"},Qe={class:"stats-grid"},We={class:"stat-box"},Ye={class:"stat-value"},Ze={class:"stat-box"},er={class:"stat-value"},rr={key:0,class:"info-box"},ar={class:"info-box-value"},nr={class:"info-box-detail"},tr={class:"recent-card"},lr={class:"formula-list"},sr=["onClick"],or={class:"formula-item-header"},dr={class:"formula-name"},ir={class:"formula-collection"},cr={class:"formula-code"},ur={class:"formula-meta"},mr={key:0,class:"formula-empty"},vr={key:2,class:"result-json"},fr={__name:"module",setup(a){const z=e();let S=({title:e,message:r,type:a})=>{const n=r??"";"error"===a||"danger"===a?console.error(e,n):"warning"===a?console.warn(e,n):console.log(e,n)};try{const e="function"==typeof r?r():null,a=e?.useNotificationsStore?.();a?.add&&(S=({title:e,message:r,type:n})=>a.add({title:e,message:r,text:r,type:n}))}catch(e){}const R=n(!0),fr=n(null),pr=n([]),gr=n(null),hr=n([]),br=n(""),yr=n(""),xr=n(""),kr=n(null),wr=n(!0),_r=n(100),Cr=n(!1),zr=n(!1),Sr=n(null),Rr=n(!1),Fr=n(""),Vr=n("{}"),Or=n(!1),Ur=n(null),Ar=n(null),Nr=n(!1),Tr=t(()=>{const e={};for(const r of pr.value){const a=r.collection_cible;e[a]||(e[a]=[]),e[a].push(r)}return e}),jr=t(()=>Object.entries(Tr.value).map(([e,r])=>({value:e,text:`${e} (${r.length} formule${r.length>1?"s":""})`}))),Er=t(()=>{if(!gr.value)return[];return(Tr.value[gr.value]||[]).map(e=>e.champ_cible)}),Lr=t(()=>{if(!br.value.trim())return jr.value;const e=br.value.trim().toLowerCase();return jr.value.filter(({value:r,text:a})=>{const n=`${r??""}`.toLowerCase(),t=`${a??""}`.toLowerCase();return n.includes(e)||t.includes(e)})}),$r=t(()=>{const e=Er.value;if(!yr.value.trim())return e;const r=yr.value.trim().toLowerCase();return e.filter(e=>e.toLowerCase().includes(r))}),Dr=t(()=>!!$r.value.length&&$r.value.every(e=>hr.value.includes(e))),Mr=t(()=>{if(!$r.value.length)return!1;const e=$r.value.filter(e=>hr.value.includes(e));return e.length>0&&e.length<$r.value.length}),Jr=t(()=>[...pr.value].sort((e,r)=>{const a=e.date_updated?new Date(e.date_updated):new Date(0);return(r.date_updated?new Date(r.date_updated):new Date(0))-a}).slice(0,5)),qr=t(()=>Boolean(gr.value)&&!zr.value),Ir=t(()=>Sr.value?JSON.stringify(Sr.value,null,2):"");function Br(e){const r=$r.value.length?$r.value:Er.value;if(r.length)if(e.target.checked){const e=new Set([...hr.value,...r]);hr.value=Er.value.filter(r=>e.has(r))}else{const e=new Set(r);hr.value=hr.value.filter(r=>!e.has(r))}}function Gr(){gr.value=null,hr.value=[],br.value="",yr.value="",xr.value="",kr.value=null,_r.value=100,Cr.value=!1,Sr.value=null}async function Pr(){R.value=!0,fr.value=null;try{console.log("[Module] Chargement des formules depuis quartz_formulas...");const{data:e}=await z.get("/items/quartz_formulas",{params:{limit:-1,fields:["id","collection_cible","champ_cible","formula","scope","status","date_updated"]}});console.log("[Module] Formules reçues:",e),pr.value=e?.data||[],console.log("[Module] Nombre de formules:",pr.value.length),0===Object.keys(Tr.value).length?gr.value=null:gr.value||(gr.value=Object.keys(Tr.value)[0])}catch(e){console.error("[Module] Erreur lors du chargement:",e);const r=e?.response?.data?.errors?.[0]?.message||e?.message||String(e);fr.value=r,S({title:"Erreur de chargement",message:r,type:"error"})}finally{R.value=!1}}async function Xr(){Nr.value=!0;try{await z.post("/realtime-calc/clear-cache"),S({title:"Cache vidé",message:"Le cache des formules a été vidé avec succès",type:"success"})}catch(e){const r=e?.response?.data?.error||e?.message||String(e);S({title:"Erreur",message:`Impossible de vider le cache: ${r}`,type:"error"})}finally{Nr.value=!1}}async function Hr(){if(Fr.value.trim()){Or.value=!0,Ur.value=null,Ar.value=null;try{let e={};if(Vr.value&&Vr.value.trim())try{e=JSON.parse(Vr.value)}catch(e){return Ar.value=`JSON invalide: ${e.message}`,void(Or.value=!1)}const{data:r}=await z.post("/realtime-calc/test-formula",{formula:Fr.value,sampleData:e});Ur.value=r,r.valid?S({title:"Formule valide",message:`Résultat: ${r.result}`,type:"success"}):S({title:"Formule invalide",message:r.error,type:"error"})}catch(e){const r=e?.response?.data?.error||e?.message||String(e);Ar.value=r,S({title:"Erreur test",message:r,type:"error"})}finally{Or.value=!1}}}function Kr(){Fr.value="",Vr.value="{}",Ur.value=null,Ar.value=null}function Qr(){let e=null;if(xr.value&&xr.value.trim())try{e=JSON.parse(xr.value),kr.value=null}catch(e){throw kr.value=e?.message||String(e),e}if(wr.value){const r={status:{_neq:"archived"}};return e?e._and?{_and:[...e._and,r]}:{_and:[e,r]}:r}return e}async function Wr(){if(gr.value){Rr.value=!0,kr.value=null;try{let e=null;try{e=Qr()}catch(e){return S({title:"Filtre invalide",message:"Ton filtre JSON n'est pas valide.",type:"error"}),void(Rr.value=!1)}const r={limit:1,fields:["*"]};e&&(r.filter=e);const{data:a}=await z.get(`/items/${gr.value}`,{params:r}),n=a?.data||[];if(0===n.length)return S({title:"Aucun item",message:"Aucun item trouvé avec le filtre actuel.",type:"warning"}),void(Rr.value=!1);const t=n[0],l=hr.value.length>0?hr.value:null,{data:s}=await z.post("/realtime-calc/calculate",{collection:gr.value,data:t,fields:l});s.success?(Sr.value={success:!0,collection:gr.value,processed:1,updated:Object.keys(s.updates).length>0?1:0,total:1,dryRun:!0,updatedItems:[{id:t.id,updates:s.updates}],message:`Aperçu: ${Object.keys(s.updates).length} champ(s) seraient modifiés`},S({title:"Aperçu généré",message:`${Object.keys(s.updates).length} champ(s) seraient modifiés`,type:"success"})):S({title:"Erreur aperçu",message:s.error||"Erreur lors du calcul",type:"error"})}catch(e){const r=e?.response?.data?.error||e?.message||String(e);S({title:"Erreur aperçu",message:r,type:"error"})}finally{Rr.value=!1}}else S({title:"Collection manquante",message:"Choisis une collection à prévisualiser.",type:"warning"})}async function Yr(){if(!gr.value)return void S({title:"Collection manquante",message:"Choisis une collection à recalculer.",type:"warning"});kr.value=null,Sr.value=null;let e=null;try{e=Qr()}catch(e){return void S({title:"Filtre invalide",message:"Ton filtre JSON n'est pas valide.",type:"error"})}const r={collection:gr.value,dryRun:Cr.value,batchSize:Math.max(1,Math.min(500,Number(_r.value)||100))};e&&(r.filter=e);const a=Er.value,n=Array.from(new Set(hr.value));n.length>0&&n.length<a.length&&(r.fields=n),zr.value=!0,console.log("[Module] Envoi du recalcul avec payload:",r);try{const{data:e}=await z.post("/realtime-calc/utils/realtime-calc.recalculate-collection",r);console.log("[Module] Réponse reçue:",e),Sr.value=e||null;S({title:"Recalcul",message:e?.message||(e?.success?"Recalcul terminé.":"Recalcul terminé avec des erreurs."),type:e?.success?"success":"warning"})}catch(e){const r=e?.response?.data?.error||e?.message||String(e);S({title:"Erreur recalcul",message:r,type:"error"})}finally{zr.value=!1}}return l(gr,e=>{if(Sr.value=null,kr.value=null,yr.value="",!e)return void(hr.value=[]);const r=(Tr.value[e]||[]).map(e=>e.champ_cible);hr.value=r}),l(xr,()=>{kr.value=null}),s(Pr),(e,r)=>{const a=o("v-icon"),n=o("v-button"),t=o("v-progress-circular"),l=o("v-notice"),s=o("v-progress-linear"),z=o("v-textarea"),S=o("v-select"),Qr=o("v-input"),Zr=o("v-checkbox"),ea=o("private-view"),ra=d("tooltip");return c(),i(ea,{title:"Recalcul des formules"},{headline:u(()=>r[11]||(r[11]=[p("Formules",-1)])),"title-outer:prepend":u(()=>[f(n,{class:"header-icon",rounded:"",disabled:"",icon:"",secondary:""},{default:u(()=>[f(a,{name:"auto_graph"})]),_:1})]),actions:u(()=>[R.value||fr.value?h("v-if",!0):y((c(),i(n,{key:0,rounded:"",icon:"",onClick:Xr,loading:Nr.value},{default:u(()=>[f(a,{name:"delete_sweep"})]),_:1},8,["loading"])),[[ra,"Vider le cache"]]),R.value||fr.value?h("v-if",!0):y((c(),i(n,{key:1,rounded:"",icon:"",onClick:Pr},{default:u(()=>[f(a,{name:"refresh"})]),_:1})),[[ra,"Recharger"]])]),default:u(()=>[m("div",F,[R.value?(c(),v("div",V,[f(t,{indeterminate:"",size:32}),r[12]||(r[12]=m("span",null,"Chargement des formules…",-1))])):fr.value?(c(),i(l,{key:1,type:"danger",icon:"error"},{default:u(()=>[p(g(fr.value),1)]),_:1})):(c(),v("div",O,[h(" Result Alert - Top "),Sr.value&&!zr.value?(c(),v("div",U,[m("div",{class:b(["result-card-header",Sr.value.success?"result-success":"result-warning"])},[m("div",A,[f(a,{name:Sr.value.success?"check_circle":"warning",large:""},null,8,["name"])]),m("div",N,[m("h3",T,g(Sr.value.message||(Sr.value.success?"Recalcul terminé avec succès":"Recalcul terminé avec des erreurs")),1),m("div",j,[m("span",E,[f(a,{name:"storage","x-small":""}),p(" "+g(Sr.value.collection),1)]),Sr.value.fields&&Sr.value.fields.length?(c(),v("span",L,g(Sr.value.fields.length)+" champ(s) recalculé(s) ",1)):h("v-if",!0),Sr.value.dryRun?(c(),v("span",$,[f(a,{name:"visibility","x-small":""}),r[13]||(r[13]=p(" Dry Run ",-1))])):h("v-if",!0)])])],2),m("div",D,[m("div",M,[m("div",J,[f(a,{name:"check_circle",small:""})]),m("div",q,[r[14]||(r[14]=m("span",{class:"result-stat-label"},"Items traités",-1)),m("span",I,g(Sr.value.processed??"–"),1)])]),m("div",B,[m("div",G,[f(a,{name:"edit",small:""})]),m("div",P,[r[15]||(r[15]=m("span",{class:"result-stat-label"},"Items modifiés",-1)),m("span",X,g(Sr.value.updated??"–"),1)])]),void 0!==Sr.value.total?(c(),v("div",H,[m("div",K,[f(a,{name:"dataset",small:""})]),m("div",Q,[r[16]||(r[16]=m("span",{class:"result-stat-label"},"Total",-1)),m("span",W,g(Sr.value.total),1)])])):h("v-if",!0)])])):h("v-if",!0),h(" Progress Bar "),zr.value?(c(),v("div",Y,[r[17]||(r[17]=m("div",{class:"progress-header"},[m("span",{class:"progress-title"},"Recalculation en cours..."),m("span",{class:"progress-status"},"Traitement des données")],-1)),f(s,{indeterminate:""}),m("div",Z,[m("span",null,"Collection: "+g(gr.value),1),hr.value.length?(c(),v("span",ee,g(hr.value.length)+" champ(s) sélectionné(s)",1)):h("v-if",!0)])])):h("v-if",!0),h(" Formula Tester - Collapsible "),m("details",re,[m("summary",ae,[f(a,{name:"science",small:""}),r[18]||(r[18]=m("span",null,"Testeur de Formule",-1)),r[19]||(r[19]=m("span",{class:"formula-tester-badge"},"Nouveau",-1))]),m("div",ne,[m("div",te,[r[20]||(r[20]=m("label",{class:"form-label"},"Formule à tester",-1)),f(z,{modelValue:Fr.value,"onUpdate:modelValue":r[0]||(r[0]=e=>Fr.value=e),placeholder:"Exemple: {{prix_ht}} * (1 + {{tva_rate}})",rows:"2","font-family":"monospace"},null,8,["modelValue"]),m("span",le,"Utilisez la syntaxe DSL avec "+g(e.champ),1)]),m("div",se,[r[21]||(r[21]=m("label",{class:"form-label"},"Données de test (JSON)",-1)),f(z,{modelValue:Vr.value,"onUpdate:modelValue":r[1]||(r[1]=e=>Vr.value=e),placeholder:'{"prix_ht": 100, "tva_rate": 0.2}',rows:"3","font-family":"monospace"},null,8,["modelValue"]),r[22]||(r[22]=m("span",{class:"form-hint"},"Fournissez les valeurs pour chaque champ utilisé dans la formule",-1)),Ar.value?(c(),v("span",oe,g(Ar.value),1)):h("v-if",!0)]),m("div",de,[f(n,{onClick:Hr,loading:Or.value,disabled:!Fr.value.trim()},{default:u(()=>[f(a,{name:"play_arrow",left:""}),r[23]||(r[23]=p(" Tester ",-1))]),_:1,__:[23]},8,["loading","disabled"]),f(n,{onClick:Kr,disabled:Or.value,secondary:""},{default:u(()=>r[24]||(r[24]=[p(" Réinitialiser ",-1)])),_:1,__:[24]},8,["disabled"])]),h(" Test Result "),Ur.value?(c(),v("div",{key:0,class:b(["test-result-card",Ur.value.valid?"test-result-success":"test-result-error"])},[m("div",ie,[f(a,{name:Ur.value.valid?"check_circle":"error"},null,8,["name"]),m("span",ce,g(Ur.value.valid?"Formule valide":"Formule invalide"),1)]),Ur.value.valid?(c(),v("div",ue,[m("div",me,[r[25]||(r[25]=m("span",{class:"test-result-label"},"Résultat :",-1)),m("span",ve,g(Ur.value.result),1)]),Ur.value.fields&&Ur.value.fields.length?(c(),v("div",fe,[r[26]||(r[26]=m("span",{class:"test-result-label"},"Dépendances :",-1)),m("span",pe,g(Ur.value.fields.join(", ")),1)])):h("v-if",!0),m("div",ge,[r[27]||(r[27]=m("span",{class:"test-result-label"},"Type :",-1)),m("span",{class:b(["test-result-badge",Ur.value.isLocal?"badge-local":"badge-relational"])},g(Ur.value.isLocal?"Locale":"Relationnelle"),3)])])):(c(),v("div",he,g(Ur.value.error),1))],2)):h("v-if",!0)])]),h(" Main Content Grid "),m("div",be,[h(" Left: Configuration Form "),m("div",ye,[r[40]||(r[40]=m("div",{class:"card-header"},[m("h3",{class:"card-title"},"Configuration")],-1)),m("div",xe,[m("div",ke,[m("div",we,[r[28]||(r[28]=m("div",{class:"select-group-titles"},[m("label",{class:"form-label"},"Collection"),m("span",{class:"form-subtitle"},"Choisissez la source à recalculer")],-1)),jr.value.length?(c(),v("span",_e,g(Lr.value.length)+" / "+g(jr.value.length),1)):h("v-if",!0)]),y(m("input",{class:"select-search",type:"search","onUpdate:modelValue":r[2]||(r[2]=e=>br.value=e),disabled:0===jr.value.length,placeholder:"Rechercher une collection..."},null,8,Ce),[[x,br.value,void 0,{trim:!0}]]),f(S,{items:Lr.value,disabled:0===jr.value.length,placeholder:"Sélectionnez une collection...",modelValue:gr.value,"onUpdate:modelValue":r[3]||(r[3]=e=>gr.value=e)},null,8,["items","disabled","modelValue"]),br.value&&0===Lr.value.length?(c(),v("span",ze," Aucune collection ne correspond à cette recherche ")):h("v-if",!0)]),m("div",Se,[r[30]||(r[30]=m("label",{class:"form-label"},"Champs à recalculer",-1)),m("div",Re,[m("div",Fe,[m("div",Ve,[m("div",Oe,[m("input",{type:"checkbox",id:"selectAllFields",checked:Dr.value,".indeterminate":Mr.value,onChange:Br,disabled:!gr.value||0===Er.value.length||0===$r.value.length},null,40,Ue),r[29]||(r[29]=m("label",{for:"selectAllFields"},"Sélectionner tout",-1))]),Er.value.length?(c(),v("span",Ae,g($r.value.length)+" / "+g(Er.value.length),1)):h("v-if",!0)]),y(m("input",{class:"fields-search",type:"search","onUpdate:modelValue":r[4]||(r[4]=e=>yr.value=e),disabled:!gr.value||0===Er.value.length,placeholder:"Rechercher un champ..."},null,8,Ne),[[x,yr.value,void 0,{trim:!0}]])]),gr.value?0===Er.value.length?(c(),v("div",je," Aucune formule trouvée pour cette collection ")):0===$r.value.length?(c(),v("div",Ee," Aucun champ ne correspond à cette recherche ")):(c(!0),v(k,{key:3},w($r.value,e=>(c(),v("div",{key:e,class:"field-item",onClick:r=>function(e){const r=hr.value.indexOf(e);r>-1?hr.value.splice(r,1):hr.value.push(e)}(e)},[y(m("input",{type:"checkbox",id:`field_${e}`,value:e,"onUpdate:modelValue":r[5]||(r[5]=e=>hr.value=e),onClick:r[6]||(r[6]=_(()=>{},["stop"]))},null,8,$e),[[C,hr.value]]),m("label",{for:`field_${e}`},g(e),9,De)],8,Le))),128)):(c(),v("div",Te," Sélectionnez d'abord une collection "))]),r[31]||(r[31]=m("span",{class:"form-hint"},"Laissez vide pour recalculer tous les champs",-1))]),m("div",Me,[m("div",Je,[r[33]||(r[33]=m("label",{class:"form-label",style:{margin:"0"}},"Filtre (optionnel)",-1)),m("div",qe,[y(m("input",{type:"checkbox",id:"excludeArchived","onUpdate:modelValue":r[7]||(r[7]=e=>wr.value=e),style:{margin:"0"}},null,512),[[C,wr.value]]),r[32]||(r[32]=m("label",{for:"excludeArchived",style:{margin:"0",cursor:"pointer","font-size":"0.75rem",color:"var(--theme--foreground-subdued)"}}," Exclure archivés ",-1))])]),f(z,{modelValue:xr.value,"onUpdate:modelValue":r[8]||(r[8]=e=>xr.value=e),placeholder:'{"status": {"_eq": "published"}}',rows:"2"},null,8,["modelValue"]),r[34]||(r[34]=m("span",{class:"form-hint"},"Filtre JSON pour sélectionner les items à traiter",-1)),kr.value?(c(),v("span",Ie,g(kr.value),1)):h("v-if",!0)]),m("div",Be,[r[35]||(r[35]=m("label",{class:"form-label"},"Taille de batch",-1)),f(Qr,{modelValue:_r.value,"onUpdate:modelValue":r[9]||(r[9]=e=>_r.value=e),modelModifiers:{number:!0},type:"number",min:1,max:500,placeholder:"100"},null,8,["modelValue"]),r[36]||(r[36]=m("span",{class:"form-hint"},"Nombre d'items traités par lot (recommandé: 100)",-1))]),m("div",Ge,[f(Zr,{modelValue:Cr.value,"onUpdate:modelValue":r[10]||(r[10]=e=>Cr.value=e),label:"Mode test (Dry Run) - Ne modifie pas les données"},null,8,["modelValue"])]),m("div",Pe,[f(n,{loading:zr.value,disabled:!qr.value,onClick:Yr,large:""},{default:u(()=>[f(a,{name:"play_arrow",left:""}),r[37]||(r[37]=p(" Lancer la recalculation ",-1))]),_:1,__:[37]},8,["loading","disabled"]),f(n,{loading:Rr.value,disabled:!gr.value||zr.value,onClick:Wr,secondary:"",large:""},{default:u(()=>[f(a,{name:"visibility",left:""}),r[38]||(r[38]=p(" Aperçu (1 item) ",-1))]),_:1,__:[38]},8,["loading","disabled"]),f(n,{onClick:Gr,disabled:zr.value||Rr.value,secondary:""},{default:u(()=>r[39]||(r[39]=[p(" Réinitialiser ",-1)])),_:1,__:[39]},8,["disabled"])])])]),h(" Right: Stats & Recent Formulas "),m("div",Xe,[h(" Stats Card "),m("div",He,[r[44]||(r[44]=m("div",{class:"card-header"},[m("h3",{class:"card-title"},"Statistiques")],-1)),m("div",Ke,[m("div",Qe,[m("div",We,[r[41]||(r[41]=m("div",{class:"stat-label"},"Formulas",-1)),m("div",Ye,g(pr.value.length),1)]),m("div",Ze,[r[42]||(r[42]=m("div",{class:"stat-label"},"Collections",-1)),m("div",er,g(Object.keys(Tr.value).length),1)])]),gr.value?(c(),v("div",rr,[r[43]||(r[43]=m("div",{class:"info-box-label"},"Collection sélectionnée",-1)),m("div",ar,g(gr.value),1),m("div",nr,g(Er.value.length)+" formule(s) disponible(s)",1)])):h("v-if",!0)])]),h(" Recent Formulas Card "),m("div",tr,[r[45]||(r[45]=m("div",{class:"card-header"},[m("h3",{class:"card-title"},"Formules récentes"),m("span",{class:"badge badge-success"},"Live")],-1)),m("div",lr,[(c(!0),v(k,null,w(Jr.value,e=>(c(),v("div",{key:e.id,class:"formula-item",onClick:r=>function(e){br.value="",gr.value=e.collection_cible}(e)},[m("div",or,[m("div",dr,g(e.champ_cible),1),m("div",ir,g(e.collection_cible),1)]),m("div",cr,g(e.formula),1),m("div",ur,[m("span",null,g(e.scope),1)])],8,sr))),128)),0===pr.value.length?(c(),v("div",mr," Aucune formule disponible ")):h("v-if",!0)])])])]),h(" Debug: JSON Result "),Sr.value?(c(),v("details",vr,[r[46]||(r[46]=m("summary",null,"Voir la réponse complète (JSON)",-1)),m("pre",null,g(Ir.value),1)])):h("v-if",!0)]))])]),_:1})}}};var pr=a({id:"realtime-recalc-dashboard",name:"Formula Engine",icon:"calculate",routes:[{path:"",component:R(fr,[["__scopeId","data-v-554ffcde"]])}]});export{pr as default};
